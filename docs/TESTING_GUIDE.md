# 程序测试指南 📋

本指南将帮助你全面测试TmpLink上传器程序。

## 🚀 快速测试步骤

### 1. 自动化测试（推荐先运行）

```bash
# 进入项目目录
cd /Users/xiefan/Documents/GitHub/tmplink_uploader

# 运行单元测试（快速，2-3秒）
make test-short

# 运行完整测试套件
make test

# 生成覆盖率报告
make test-coverage
open coverage.html  # 查看详细覆盖率
```

### 2. 构建程序

```bash
# 构建二进制文件
make build

# 检查构建结果
ls -la tmplink-uploader
```

## 🎮 手动测试程序

### 基础功能测试

#### 1. 启动程序

```bash
# 直接运行
./tmplink-uploader

# 或者使用 make
make run
```

**期望结果：**
- 显示欢迎信息
- 提示登录（如果是首次运行）

#### 2. 登录测试

⚠️ **注意：** 程序会尝试连接真实的钛盘API，请确保：
- 网络连接正常
- 有有效的钛盘账号
- 或准备测试无效登录的错误处理

**测试用例：**

```bash
# 测试有效登录
邮箱地址: your_email@example.com
密码: your_password

# 测试无效登录
邮箱地址: invalid@example.com  
密码: wrongpassword
```

**期望结果：**
- 有效登录：进入主菜单
- 无效登录：显示错误信息，重新提示登录

#### 3. 菜单导航测试

登录成功后，测试主菜单功能：

```
=== 钛盘文件上传工具 ===
请选择操作:
► 上传设定
  上传文件  
  查看上传列表
  退出程序
```

### 详细功能测试

#### 📝 测试1：上传设定

1. 选择"上传设定"
2. 测试各项配置：

```
上传设定:
► 设置上传服务器 (当前: )
  设置分片大小 (当前: 3MB)
  设置并发上传数 (当前: 5个)
  秒传功能 (当前: 开启)
  跳过上传功能 (当前: 关闭)
  返回主菜单
```

**测试用例：**

| 功能 | 测试值 | 期望结果 |
|------|--------|----------|
| 分片大小 | 1, 5, 80, 81, 0 | 1-80有效，其他显示错误 |
| 并发数 | 1, 5, 10, 11, 0 | 1-10有效，其他显示错误 |
| 秒传功能 | 开启/关闭 | 状态切换，显示说明 |
| 跳过上传 | 开启（需要秒传） | 自动开启秒传 |

#### 📁 测试2：文件上传

创建测试文件：

```bash
# 在项目目录创建测试文件
echo "这是一个测试文件" > test1.txt
echo "另一个测试文件，内容稍长一些，用于测试上传功能" > test2.txt
dd if=/dev/zero of=large_test.bin bs=1024 count=1024  # 1MB测试文件
```

**测试用例：**

1. 选择"上传文件"
2. 应该看到文件列表
3. 选择文件进行上传

**期望结果：**
- 显示当前目录文件
- 显示文件大小
- 支持文件选择
- 显示上传进度

#### 📊 测试3：查看上传列表

**测试用例：**

1. 在有上传任务时选择"查看上传列表"
2. 验证显示内容

**期望结果：**
```
=== 上传状态 ===
队列中: X 个文件
正在上传: Y 个文件  
已完成: Z 个文件

正在上传:
  file1.txt - 45%
  file2.txt - 78%

等待上传:
  file3.txt
  
已完成:
  ✓ test1.txt - https://tmp.link/xxx123
  ✗ failed.txt - 上传失败: 网络错误
```

## 🧪 特殊场景测试

### 网络异常测试

1. **断网测试**
   ```bash
   # 断开网络连接后运行程序
   ./tmplink-uploader
   ```
   
2. **API错误测试**
   - 使用无效的API endpoint
   - 测试超时处理

### 配置测试

1. **配置文件测试**
   ```bash
   # 检查配置文件位置
   ls ~/.tmplink_config.json
   
   # 删除配置文件，测试默认配置
   rm ~/.tmplink_config.json
   ./tmplink-uploader
   ```

2. **配置持久化测试**
   - 修改配置
   - 重启程序
   - 验证配置是否保存

### 文件处理测试

1. **特殊文件名测试**
   ```bash
   # 创建特殊字符文件名
   touch "文件 with spaces.txt"
   touch "特殊字符!@#$%.txt"
   touch "emoji🚀test.txt"
   ```

2. **大文件测试**
   ```bash
   # 创建大文件（100MB）
   dd if=/dev/zero of=large_file.bin bs=1024 count=102400
   ```

3. **空文件测试**
   ```bash
   touch empty_file.txt
   ```

## 📈 性能测试

### 1. 运行基准测试

```bash
make test-bench
```

**期望结果：**
```
BenchmarkFormatBytes-8   	 1921197	       623.1 ns/op
```

### 2. 内存使用测试

```bash
# 监控内存使用
top -pid $(pgrep tmplink-uploader)

# 或使用 time 命令
/usr/bin/time -l ./tmplink-uploader
```

### 3. 并发测试

```bash
# 运行竞态检测
make test-race
```

## 🐛 错误处理测试

### 常见错误场景

1. **权限错误**
   ```bash
   # 创建无读取权限的文件
   touch no_permission.txt
   chmod 000 no_permission.txt
   ```

2. **磁盘空间不足**
   ```bash
   # 检查磁盘空间
   df -h
   ```

3. **文件不存在**
   - 程序运行中删除文件
   - 测试错误处理

4. **网络超时**
   - 使用防火墙阻断连接
   - 测试超时重试

## 📝 测试记录模板

创建测试记录：

```markdown
## 测试记录 - YYYY-MM-DD

### 环境信息
- 操作系统: macOS 14.x
- Go版本: 1.21
- 网络状态: 正常/异常

### 测试结果

| 功能 | 状态 | 备注 |
|------|------|------|
| 程序启动 | ✅ | 正常显示菜单 |
| 用户登录 | ✅ | API响应正常 |
| 配置管理 | ✅ | 保存和加载正常 |
| 文件上传 | ❌ | 大文件上传超时 |
| 错误处理 | ✅ | 错误信息清晰 |

### 发现的问题
1. 大文件上传可能超时
2. 特殊字符文件名处理

### 建议改进
1. 增加上传超时配置
2. 改进文件名编码处理
```

## 🔧 调试模式

如果遇到问题，可以启用详细日志：

```bash
# 设置环境变量启用调试
export DEBUG=1
./tmplink-uploader

# 或者查看配置文件
cat ~/.tmplink_config.json
```

## ✅ 测试清单

### 基础功能 ✅
- [ ] 程序启动
- [ ] 帮助信息显示
- [ ] 配置文件创建和读取
- [ ] 用户登录流程

### 上传功能 📤
- [ ] 文件列表显示
- [ ] 文件选择
- [ ] 小文件上传（< 1MB）
- [ ] 大文件上传（> 10MB）
- [ ] 进度显示
- [ ] 秒传功能
- [ ] 并发上传

### 配置管理 ⚙️
- [ ] 服务器设置
- [ ] 分片大小配置
- [ ] 并发数配置
- [ ] 秒传开关
- [ ] 跳过上传开关
- [ ] 配置持久化

### 错误处理 🚨
- [ ] 网络错误
- [ ] 认证失败
- [ ] 文件读取错误
- [ ] API错误响应
- [ ] 配置错误

### 性能测试 🚀
- [ ] 内存使用合理
- [ ] CPU使用正常
- [ ] 大文件处理
- [ ] 并发安全性

---

**记住：** 测试是确保软件质量的重要环节。如果发现任何问题，请记录详细的错误信息和重现步骤！